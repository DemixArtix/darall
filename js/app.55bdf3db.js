(function(){"use strict";var t={6951:function(t,e,n){var r=n(9242),a=n(3396);const o={key:0,class:"loader"},i=(0,a._)("div",{class:"loader-ring"},[(0,a._)("div"),(0,a._)("div"),(0,a._)("div"),(0,a._)("div")],-1),s=[i],c={class:"flex gap-2 justify-center p-3 relative w-fit mx-auto"};function u(t,e){const n=(0,a.up)("router-link"),i=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)(a.HY,null,[t.$store.getters["loader"]?((0,a.wg)(),(0,a.iD)("div",o,s)):(0,a.kq)("",!0),(0,a._)("nav",c,[(0,a.Wm)(n,{class:"link btn btn-light w-[150px]",to:"/"},{default:(0,a.w5)((()=>[(0,a.Uk)("Меню")])),_:1}),(0,a.Wm)(n,{class:"link btn btn-light w-[150px]",to:"/editor"},{default:(0,a.w5)((()=>[(0,a.Uk)("Редактор")])),_:1}),t.$store.getters["user/auth"]?((0,a.wg)(),(0,a.iD)("a",{key:0,class:"text-green block mt-2 cursor-pointer absolute left-full",onClick:e[0]||(e[0]=(0,r.iM)((e=>t.$store.dispatch("user/logOut")),["prevent"]))},"Выход")):(0,a.kq)("",!0)]),(0,a.Wm)(i)],64)}var l=n(89);const d={},h=(0,l.Z)(d,[["render",u]]);var p=h,f=n(2483),m=n(65),g=(n(7658),n(4311)),y={baseURL:"https://darall.vercel.app"},v=n(680);function b(t){const e=v.Z.get(t);return"undefined"!=e&&e?e:null}let k=b("access_token"),w=b("refresh_token");const _=()=>k,E=()=>w;async function S({login:t,password:e}){return await D({method:"post",url:"/login",data:{login:t,password:e},skipAuth:!0}).then((t=>{const{data:e}=t;return k=e.access_token,w=e.refresh_token,e}))}async function O(){return await D({method:"get",url:"/refresh",headers:{"x-refresh-token":w},skipAuth:!0}).then((async t=>{const{data:e}=t;return k=e.access_token,w=e.refresh_token,e}))}var C=n(9507);const A=g.Z.create({baseURL:y.baseURL,validateStatus:t=>t<500});async function T(){let t=_(),e=E();const n=Math.floor(.001*Date.now());if(t){const{payloadObj:{exp:r}}=C.fs.jws.JWS.parse(t);return e?n>r&&(t=await j.dispatch("user/authRefresh")):await j.dispatch("user/logOut"),t}return null}A.interceptors.request.use((async t=>{if(t.skipAuth)return t;const e=await T();return e?{...t,headers:{"x-access-token":e}}:t})),A.interceptors.response.use((t=>{const{data:{errors:e},config:{skipErrors:n},status:r}=t;return 403===r?"menu"!==P.currentRoute.name&&P.push({name:"menu"}):401===r?j.dispatch("user/logOut"):e&&!n&&console.log(e),t}),(t=>Promise.reject(t)));var D=A,x={namespaced:!0,state:{auth:{auth:null,loaded:!1}},getters:{loaded({auth:t}){return new Promise(((e,n)=>{const r=setInterval((()=>{t.loaded&&(e(!0),clearInterval(r))}),100)}))},auth:({auth:t})=>t.auth},mutations:{},actions:{async init({state:t,dispatch:e}){v.Z.get("refresh_token")?(t.auth.loaded=!0,t.auth.auth=!0):(t.auth.loaded=!0,t.auth.auth=!1)},async onLogin({dispatch:t},e){let n=await S(e);n&&(await v.Z.set("access_token",n.access_token,{expires:120,sameSite:"Strict",secure:"https:"===location.protocol}),await v.Z.set("refresh_token",n.refresh_token,{expires:120,sameSite:"Strict",secure:"https:"===location.protocol}),P.push({name:"editor"}))},async onRegister({dispatch:t},e){await t("api",{url:"/register",body:e,resField:"body",action:"post"},{root:!0}).then((t=>{console.log(t),201===t.status&&P.push({name:"login"})}))},async authRefresh({state:t,commit:e,dispatch:n}){try{const{access_token:t,refresh_token:e}=await O();return v.Z.set("access_token",t,{expires:120,sameSite:"Strict",secure:"https:"===location.protocol}),v.Z.set("refresh_token",e,{expires:120,sameSite:"Strict",secure:"https:"===location.protocol}),t}catch(r){return n("logOut"),null}},async logOut({state:t,state:{auth:e}}){v.Z.remove("access_token"),v.Z.remove("refresh_token"),t.user=null,e.auth=!1,await P.push({name:"auth"})},async getDishes({state:t,commit:e,dispatch:n}){try{const{items:e}=await n("api",{url:"posts",action:"get"},{root:!0});return t.posts=e||[],console.log(e),e}catch(r){return null}},async sendDish({state:t,commit:e,dispatch:n},r){try{await n("api",{url:"posts",action:"post",form:!0,body:r},{root:!0}).then((t=>{console.log(t)}))}catch(a){return null}}}},R={namespaced:!0,state:{menu:[]},getters:{menu:({menu:t})=>t},mutations:{SET_MENU(t,e){t.menu=e}},actions:{async getMenu({dispatch:t,state:e,commit:n}){await t("api",{url:"/menu",action:"get"},{root:!0}).then((t=>{n("SET_MENU",t.menu)}))}}},I=(n(541),{namespaced:!0,state:{activeCategory:null,list:[]},getters:{list:({list:t})=>t},mutations:{ADD_CATEGORY(t,e){e.dishes=[],t.list.unshift(e)},REMOVE_CATEGORY(t,e){t.list.splice(t.list.findIndex((t=>t.id===e)),1)},ADD_DISH(t,e){for(let n in t.list)if(t.list[n].id==e.categoryId){t.list[n].dishes.unshift(e);break}},REMOVE_DISH(t,{id:e,categoryId:n}){for(let r in t.list)if(t.list[r].id==n){for(let n in t.list[r].dishes)if(t.list[r].dishes[n].id==e){t.list[r].dishes.splice(n,1);break}break}},SET_ACTIVE_CATEGORY(t,e){t.activeCategory=e},SET_DISHES_LIST(t,e){t.list=e}},actions:{async onCreateCategory({commit:t,dispatch:e},n){return await e("api",{url:"/categories",body:n,action:"post",resField:"body"},{root:!0}).then((e=>(t("ADD_CATEGORY",e.data.category),201===e.status))).catch((t=>(console.log(t),!1)))},async onRemoveCategory({commit:t,dispatch:e},n){await e("api",{url:"/categories",params:{id:n},action:"delete",resField:"body"},{root:!0}).then((e=>{t("REMOVE_CATEGORY",n)}))},async setActiveCategory({commit:t,dispatch:e},n){t("SET_ACTIVE_CATEGORY",n)},async onAddDish({commit:t,dispatch:e},n){return await e("api",{url:"/dish",body:n,action:"post",resField:"body"},{root:!0}).then((e=>(t("ADD_DISH",e.data.dish),201===e.status))).catch((t=>(console.log(t),!1)))},async onRemoveDish({commit:t,dispatch:e},{id:n,categoryId:r}){await e("api",{url:"/dish",params:{id:n},action:"delete",resField:"body"},{root:!0}).then((e=>{t("REMOVE_DISH",{id:n,categoryId:r})}))},async getDishesList({dispatch:t,state:e,commit:n}){await t("api",{url:"/dish",action:"get"},{root:!0}).then((t=>{n("SET_DISHES_LIST",t.list)}))}}}),j=(0,m.MT)({modules:{user:x,menu:R,editor:I},state:{inited:!1,loader:!1},getters:{inited:({inited:t})=>t,loader:({loader:t})=>t},mutations:{loader(t,e){t.loader=e}},actions:{init({dispatch:t,state:e}){t("user/init"),e.inited=!0},async api({getters:t},{params:e,url:n="orders",body:r,action:a="post",headers:o,skipAuth:i=!1,resField:s="data"}){const c={method:a,url:n,params:{...e},headers:{"Content-Type":"application/json",...o},skipAuth:i,data:r};return await D(c).then((t=>"body"===s?t:t[s]))}}});const M=[{path:"/",name:"menu",component:()=>n.e(343).then(n.bind(n,9343)),async beforeEnter(t,e,n){j.commit("loader",!0),await j.dispatch("menu/getMenu"),n(),j.commit("loader",!1)}},{path:"/editor",name:"editor",component:()=>Promise.all([n.e(75),n.e(712)]).then(n.bind(n,6712)),async beforeEnter(t,e,n){j.commit("loader",!0),j.getters.inited||await j.dispatch("init"),await j.getters["user/loaded"],j.getters["user/auth"]?(await j.dispatch("editor/getDishesList"),n()):n({name:"login"}),j.commit("loader",!1)}},{path:"/auth",name:"auth",redirect:{name:"register"},component:()=>n.e(924).then(n.bind(n,2924)),async beforeEnter(t,e,n){j.commit("loader",!0),j.getters.inited||await j.dispatch("init"),j.getters["user/auth"]?n({name:"editor"}):n(),j.commit("loader",!1)},children:[{path:"/register",name:"register",component:()=>Promise.all([n.e(75),n.e(959)]).then(n.bind(n,2959))},{path:"/login",name:"login",component:()=>Promise.all([n.e(75),n.e(959)]).then(n.bind(n,2959))}]}],L=(0,f.p7)({history:(0,f.PO)("/darall/"),routes:M});var P=L;n(2166);(0,r.ri)(p).use(j).use(P).mount("#app")}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}n.m=t,function(){var t=[];n.O=function(e,r,a,o){if(!r){var i=1/0;for(l=0;l<t.length;l++){r=t[l][0],a=t[l][1],o=t[l][2];for(var s=!0,c=0;c<r.length;c++)(!1&o||i>=o)&&Object.keys(n.O).every((function(t){return n.O[t](r[c])}))?r.splice(c--,1):(s=!1,o<i&&(i=o));if(s){t.splice(l--,1);var u=a();void 0!==u&&(e=u)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[r,a,o]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,r){return n.f[r](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{75:"1b224664",343:"517ab74c",712:"33b2e243",924:"6d5e74e4",959:"8e81f435"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+"."+{343:"c9614ecc",712:"5c7a4b4d"}[t]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="darall:";n.l=function(r,a,o,i){if(t[r])t[r].push(a);else{var s,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==e+o){s=d;break}}s||(c=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",e+o),s.src=r),t[r]=[a];var h=function(e,n){s.onerror=s.onload=null,clearTimeout(p);var a=t[r];if(delete t[r],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((function(t){return t(n)})),e)return e(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),c&&document.head.appendChild(s)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/darall/"}(),function(){if("undefined"!==typeof document){var t=function(t,e,n,r,a){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css";var i=function(n){if(o.onerror=o.onload=null,"load"===n.type)r();else{var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+s+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=i,c.request=s,o.parentNode.removeChild(o),a(c)}};return o.onerror=o.onload=i,o.href=e,n?n.parentNode.insertBefore(o,n.nextSibling):document.head.appendChild(o),o},e=function(t,e){for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var a=n[r],o=a.getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(o===t||o===e))return a}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){a=i[r],o=a.getAttribute("data-href");if(o===t||o===e)return a}},r=function(r){return new Promise((function(a,o){var i=n.miniCssF(r),s=n.p+i;if(e(i,s))return a();t(r,s,null,a,o)}))},a={143:0};n.f.miniCss=function(t,e){var n={343:1,712:1};a[t]?e.push(a[t]):0!==a[t]&&n[t]&&e.push(a[t]=r(t).then((function(){a[t]=0}),(function(e){throw delete a[t],e})))}}}(),function(){var t={143:0};n.f.j=function(e,r){var a=n.o(t,e)?t[e]:void 0;if(0!==a)if(a)r.push(a[2]);else{var o=new Promise((function(n,r){a=t[e]=[n,r]}));r.push(a[2]=o);var i=n.p+n.u(e),s=new Error,c=function(r){if(n.o(t,e)&&(a=t[e],0!==a&&(t[e]=void 0),a)){var o=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;s.message="Loading chunk "+e+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,a[1](s)}};n.l(i,c,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,r){var a,o,i=r[0],s=r[1],c=r[2],u=0;if(i.some((function(e){return 0!==t[e]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(c)var l=c(n)}for(e&&e(r);u<i.length;u++)o=i[u],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(l)},r=self["webpackChunkdarall"]=self["webpackChunkdarall"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=n.O(void 0,[998],(function(){return n(6951)}));r=n.O(r)})();
//# sourceMappingURL=app.55bdf3db.js.map